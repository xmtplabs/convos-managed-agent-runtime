# Convos-agent workarounds

Documented workarounds so future changes don't break them or duplicate logic.

## Plugin paths must be absolute in config

**Problem:** Writing relative paths (e.g. `./extensions`, `../openclaw/extensions`) into `plugins.load.paths` causes "plugin path not found" — OpenClaw resolves them relative to state/workspace dir (e.g. `~/.openclaw/workspace/extensions`), so the dirs don't exist.

**Workaround:** In [scripts/entrypoint.sh](scripts/entrypoint.sh), resolve both `OPENCLAW_CUSTOM_PLUGINS_DIR` and `OPENCLAW_BUNDLED_PLUGINS_DIR` to absolute paths with `cd "$DIR" && pwd` before passing them to `jq`. The config then stores real paths and validation passes.

## Memory slot: use "none" when memory-core is not present

**Problem:** Default OpenClaw config can set `plugins.slots.memory` to `memory-core`. If that extension isn't shipped (e.g. convos-agent Docker image, or minimal dev setup), config validation fails with "plugin not found: memory-core" (see openclaw/openclaw#8909).

**Workaround:** In [config/openclaw.json](config/openclaw.json), set `plugins.slots.memory` to `"none"` so no memory plugin is required. agent seeds this default so validation never expects memory-core.

## Custom extensions: additive loading

**Intent:** Add convos (and other custom extensions under `extensions/`) **without** removing OpenClaw's bundled extensions.

**Workaround:** Entrypoint adds only `OPENCLAW_CUSTOM_PLUGINS_DIR` (resolved to absolute) to `plugins.load.paths`. Do **not** add `OPENCLAW_BUNDLED_PLUGINS_DIR` — OpenClaw already discovers bundled plugins from its install path; adding the bundled dir again causes duplicate plugin id warnings for every bundled plugin.

## Extension plugin id must match package/manifest

**Problem:** If package.json `name` is e.g. `@scope/openclaw-plugin-convos`, OpenClaw derives id `openclaw-plugin-convos`. If openclaw.plugin.json or channel config says `convos`, you get "plugin id mismatch".

**Workaround:** Use a single id everywhere: set package.json `"name": "convos"` and openclaw.plugin.json `"id": "convos"` (and channel id `convos`). No scoped name for the extension package in this repo.

## Extension deps when loading from this repo (dev)

**Problem:** Custom extensions live under `extensions/` and need their own node_modules (zod, @xmtp/agent-sdk, etc.). OpenClaw loads from that dir, so "Cannot find module 'zod'" if deps aren't installed there.

**Workaround:** In entrypoint, when `OPENCLAW_CUSTOM_PLUGINS_DIR` is set, run `pnpm install` in each subdir that has a package.json before starting. Uses pnpm (not yarn) to avoid Yarn treating the subdir as part of the root workspace and failing.

## `pnpm apply` must inject plugins.load.paths (same as entrypoint)

**Problem:** Running `pnpm apply` while the gateway is already running triggers a hot-reload, but the output config has `"plugins": { "load": {} }` with no `paths` array. The gateway cannot find the `convos` plugin and rejects the config: `plugins.entries.convos: plugin not found: convos, channels.convos: unknown channel id: convos`. This happens because only `entrypoint.sh` (used by `pnpm dev`) was injecting `plugins.load.paths` via `jq`; the apply script was not.

**Workaround:** In [scripts/apply-env-to-config.sh](scripts/apply-env-to-config.sh), after the Node env-substitution step, resolve `OPENCLAW_CUSTOM_PLUGINS_DIR` (defaulting to `$ROOT/extensions`) to an absolute path and use `jq` to merge it into `plugins.load.paths` in the output config — mirroring what `entrypoint.sh` does. This ensures hot-reloads via `pnpm apply` always include the plugin path. If you add new plugin path injection logic to entrypoint.sh, keep apply-env-to-config.sh in sync.

## Registered vs script-based skills: only use `alsoAllow` for registered tools

**Problem:** There are two kinds of skills:
- **Registered skills** have a `_meta.json` in their workspace dir (e.g. `smooth-browser`). These are recognized by OpenClaw's tool system and can be referenced in `alsoAllow`/`deny`.
- **Script-based skills** have only `scripts/` and `SKILL.md` (e.g. `agentmail`). These are invoked via `exec` (running shell/node scripts). They are **not** registered as named tools — putting them in `alsoAllow` or `deny` triggers "unknown entries" warnings or is silently ignored.

Using `tools.allow` (not `alsoAllow`) for any skill name makes it "unknown" and causes OpenClaw to ignore the **entire** allowlist, exposing all core tools to the agent.

**Workaround:** In [config/openclaw.json](config/openclaw.json):

1. **`alsoAllow` only for registered skills** — only put skill names in `tools.alsoAllow` if the skill has a `_meta.json` (e.g. `smooth-browser`). Never use `tools.allow` for skill names.
2. **Script-based skills need no tool config** — `agentmail` works via `exec`. The agent's profile must include `exec` access; no `alsoAllow` entry is needed. Env vars are injected via `skills.entries.*.env`.
3. **Global `group:ui` deny** — `tools.deny: ["group:ui"]` blocks the native `browser` and `canvas` tools globally. We only use `smooth-browser` for web automation.
4. **Per-agent profiles** — restrict subagent tool access with `tools.profile`:
   - `main-agent`: inherits global `full` profile (orchestrator needs everything)
   - `browser-automation-subagent`: `"coding"` profile (fs, runtime, exec, sessions)
   - `email-subagent`: `"messaging"` profile (messaging tools only)
5. **Deny only registered tools** — `smooth-browser` can be denied on agents that shouldn't use it. Don't deny script-based skill names (no effect).

## Skill script paths: use workspace-relative paths (no leading `workspace/`)

**Problem:** The agent's exec cwd is the **workspace root** (e.g. `~/.openclaw/workspace`). The entrypoint seeds that dir with the **contents** of repo `workspace/` (so layout is `AGENTS.md`, `skills/`, etc.). There is no `workspace/` subfolder inside the seeded dir. If SKILL.md tells the agent to run `node workspace/skills/agentmail/scripts/send-email.mjs`, the path resolves to `.../workspace/workspace/skills/...` → MODULE_NOT_FOUND.

**Workaround:** In all skill docs and examples use paths relative to workspace root (e.g. `skills/agentmail/scripts/...`). Never use `workspace/skills/...`.

## agentmail (and other skill deps) require NODE_PATH when running via exec

**Problem:** The agentmail scripts `import "agentmail"`. The `agentmail` package lives in the **repo** `node_modules` (convos-concierge root), not inside the workspace. When the gateway runs `exec` with cwd = workspace, Node’s module resolution doesn’t see the repo’s node_modules, so `ERR_MODULE_NOT_FOUND` for `agentmail`.

**Workaround:** Start the gateway via [scripts/entrypoint.sh](scripts/entrypoint.sh), which sets `NODE_PATH="$ROOT/node_modules"` so exec’d Node processes inherit it and resolve `agentmail`. If you run `openclaw gateway` directly (e.g. from another terminal), set `NODE_PATH` to the repo root’s node_modules or agentmail scripts will fail.

## openclaw dependency in extension (no workspace)

**Problem:** Extension has `openclaw` in devDependencies for types/sdk. In convos-agent there is no OpenClaw workspace, so `workspace:*` fails on install.

**Workaround:** In [extensions/convos/package.json](extensions/convos/package.json), use `"openclaw": "*"` so install works; at runtime OpenClaw's loader provides the plugin-sdk. In Docker, [Dockerfile](Dockerfile) sed replaces `"openclaw": "*"` (or `workspace:*`) with `"openclaw": "file:/openclaw"` so the image resolves openclaw from the built /openclaw copy.
