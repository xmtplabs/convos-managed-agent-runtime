# Convos-agent workarounds

Documented workarounds so future changes don't break them or duplicate logic.

## Plugin paths must be absolute in config

**Problem:** Writing relative paths (e.g. `./extensions`, `../openclaw/extensions`) into `plugins.load.paths` causes "plugin path not found" — OpenClaw resolves them relative to state/workspace dir (e.g. `~/.openclaw/workspace/extensions`), so the dirs don't exist.

**Workaround:** In [scripts/entrypoint.sh](scripts/entrypoint.sh), resolve both `OPENCLAW_CUSTOM_PLUGINS_DIR` and `OPENCLAW_BUNDLED_PLUGINS_DIR` to absolute paths with `cd "$DIR" && pwd` before passing them to `jq`. The config then stores real paths and validation passes.

## Memory slot: use "none" when memory-core is not present

**Problem:** Default OpenClaw config can set `plugins.slots.memory` to `memory-core`. If that extension isn't shipped (e.g. convos-agent Docker image, or minimal dev setup), config validation fails with "plugin not found: memory-core" (see openclaw/openclaw#8909).

**Workaround:** In [config/openclaw.json](config/openclaw.json), set `plugins.slots.memory` to `"none"` so no memory plugin is required. agent seeds this default so validation never expects memory-core.

## Custom extensions: additive loading

**Intent:** Add convos (and other custom extensions under `extensions/`) **without** removing OpenClaw's bundled extensions.

**Workaround:** Entrypoint adds only `OPENCLAW_CUSTOM_PLUGINS_DIR` (resolved to absolute) to `plugins.load.paths`. Do **not** add `OPENCLAW_BUNDLED_PLUGINS_DIR` — OpenClaw already discovers bundled plugins from its install path; adding the bundled dir again causes duplicate plugin id warnings for every bundled plugin.

## Extension plugin id must match package/manifest

**Problem:** If package.json `name` is e.g. `@scope/openclaw-plugin-convos`, OpenClaw derives id `openclaw-plugin-convos`. If openclaw.plugin.json or channel config says `convos`, you get "plugin id mismatch".

**Workaround:** Use a single id everywhere: set package.json `"name": "convos"` and openclaw.plugin.json `"id": "convos"` (and channel id `convos`). No scoped name for the extension package in this repo.

## Extension deps when loading from this repo (dev)

**Problem:** Custom extensions live under `extensions/` and need their own node_modules (zod, @xmtp/agent-sdk, etc.). OpenClaw loads from that dir, so "Cannot find module 'zod'" if deps aren't installed there.

**Workaround:** [scripts/install-extension-deps.sh](scripts/install-extension-deps.sh) runs `pnpm install` (or `npm install`) in each extension subdir that has a package.json. It is invoked by **entrypoint.sh** before starting the gateway and by root **postinstall**, so no manual step is required. Uses pnpm when available to avoid Yarn treating the subdir as part of the root workspace and failing.

## `pnpm apply` must inject plugins.load.paths (same as entrypoint)

**Problem:** Running `pnpm apply` while the gateway is already running triggers a hot-reload, but the output config has `"plugins": { "load": {} }` with no `paths` array. The gateway cannot find the `convos` plugin and rejects the config: `plugins.entries.convos: plugin not found: convos, channels.convos: unknown channel id: convos`. This happens because only `entrypoint.sh` (used by `pnpm dev`) was injecting `plugins.load.paths` via `jq`; the apply script was not.

**Workaround:** In [scripts/apply-env-to-config.sh](scripts/apply-env-to-config.sh), after the Node env-substitution step, resolve `OPENCLAW_CUSTOM_PLUGINS_DIR` (defaulting to `$ROOT/extensions`) to an absolute path and use `jq` to merge it into `plugins.load.paths` in the output config — mirroring what `entrypoint.sh` does. This ensures hot-reloads via `pnpm apply` always include the plugin path. If you add new plugin path injection logic to entrypoint.sh, keep apply-env-to-config.sh in sync.

## Registered vs script-based skills: only use `alsoAllow` for registered tools

**Problem:** There are two kinds of skills:
- **Registered skills** have a `_meta.json` in their workspace dir. These are recognized by OpenClaw's tool system and can be referenced in `alsoAllow`/`deny`.
- **Script-based skills** have only `scripts/` and `SKILL.md` (e.g. `agentmail`). These are invoked via `exec` (running shell/node scripts). They are **not** registered as named tools — putting them in `alsoAllow` or `deny` triggers "unknown entries" warnings or is silently ignored.

Using `tools.allow` for a skill name (when the skill has no `_meta.json`) makes it "unknown" and can cause OpenClaw to ignore the allowlist. Use `tools.allow` only for core tool names (e.g. `browser`).

**Workaround:** In [config/openclaw.json](config/openclaw.json):

1. **`alsoAllow` only for registered skills** — only put skill names in `tools.alsoAllow` if the skill has a `_meta.json`. Never use `tools.allow` for skill names (use it for core tools like `browser`).
2. **Script-based skills need no tool config** — `agentmail` works via `exec`. The agent's profile must include `exec` access; no `alsoAllow` entry is needed. Env vars are injected via `skills.entries.*.env`.
3. **Browser** — Web automation uses the native OpenClaw `browser` tool. `browser-automation-subagent` has `tools.allow: ["browser"]`. 
4. **Per-agent config** — restrict subagent tool access:
   - `main-agent`: inherits global `full` profile (orchestrator needs everything)
   - `browser-automation-subagent`: `tools.allow: ["browser"]` only
   - `email-subagent`: `"messaging"` profile (messaging tools only)
5. **Deny only registered tools** — when you add a registered skill, deny it on agents that shouldn't use it. Don't deny script-based skill names (no effect).

## Skill script paths: use workspace-relative paths (no leading `workspace/`)

**Problem:** The agent's exec cwd is the **workspace root** (e.g. `~/.openclaw/workspace`). The entrypoint seeds that dir with the **contents** of repo `workspace/` (so layout is `AGENTS.md`, `skills/`, etc.). There is no `workspace/` subfolder inside the seeded dir. If SKILL.md tells the agent to run `node workspace/skills/agentmail/scripts/send-email.mjs`, the path resolves to `.../workspace/workspace/skills/...` → MODULE_NOT_FOUND.

**Workaround:** In all skill docs and examples use paths relative to workspace root (e.g. `skills/agentmail/scripts/...`). Never use `workspace/skills/...`.

## agentmail (and other skill deps) require workspace node_modules

**Problem:** The agentmail scripts `import "agentmail"`. The `agentmail` package lives in the **repo** `node_modules` (convos-concierge root), not inside the workspace. When the gateway runs `exec` with cwd = workspace, Node’s module resolution doesn’t see the repo’s node_modules, so `ERR_MODULE_NOT_FOUND` for `agentmail`.

**Workaround:** Start the gateway via [scripts/entrypoint.sh](scripts/entrypoint.sh), which sets `NODE_PATH="$ROOT/node_modules"` so exec’d Node processes inherit it and resolve `agentmail`. If you run `openclaw gateway` directly (e.g. from another terminal), set `NODE_PATH` to the repo root’s node_modules or agentmail scripts will fail.

## openclaw dependency in extension (no workspace)

**Problem:** Extension has `openclaw` in devDependencies for types/sdk. In convos-agent there is no OpenClaw workspace, so `workspace:*` fails on install.

**Workaround:** In [extensions/convos/package.json](extensions/convos/package.json), use `"openclaw": "*"` so install works; at runtime OpenClaw's loader provides the plugin-sdk. In Docker, [Dockerfile](Dockerfile) sed replaces `"openclaw": "*"` (or `workspace:*`) with `"openclaw": "file:/openclaw"` so the image resolves openclaw from the built /openclaw copy.

## Browser on Railway / headless (target + targetUrl)

**Problem:** On Railway (or when `CHROMIUM_PATH` is set / headless), the browser tool can fail with "Sandbox browser is unavailable", "targetUrl required", or "Can't reach the OpenClaw browser control service (Error: fields are required)". The model or browser subagent may call the browser tool with incomplete params.

**Workaround (instructions):** In [workspace/TOOLS.md](workspace/TOOLS.md), a callout under the Browser bullet instructs: in headless/cloud use `target: "host"`; for action `navigate` always pass `targetUrl` with the full URL; for other actions pass all required params (e.g. `ref` for `act`). Do not remove or shorten this callout — it fixes "targetUrl required" and "fields are required" errors (see [.cursor/plans/browser_failures_on_railway.plan.md](.cursor/plans/browser_failures_on_railway.plan.md)).

**Workaround (subagent workspace):** Non-main agents default to `~/.openclaw/workspace-<agentId>`. With `skipBootstrap: true`, that dir has no AGENTS.md/TOOLS.md, so the browser subagent never sees the required-params instructions. Do NOT set an explicit `"workspace"` on subagents — the hardcoded `"~/.openclaw/workspace"` only works locally; on Railway the actual workspace is at `$RAILWAY_VOLUME_MOUNT_PATH/workspace` (e.g. `/data/workspace`). Instead, let subagents inherit `agents.defaults.workspace` which entrypoint.sh patches to the correct `$WORKSPACE_DIR`. Both entrypoint.sh and apply-env-to-config.sh set this default, so subagents will share the main workspace and inherit the browser callout on all platforms.

**Workaround (CDP timeouts):** Chrome cold-start can exceed the default CDP timeout, causing "tab not found". In [config/openclaw.json](config/openclaw.json), `remoteCdpTimeoutMs` is set to `5000` and `remoteCdpHandshakeTimeoutMs` to `8000` (up from 1500/3000). Do not lower these — they prevent race conditions when Chrome is starting up.
